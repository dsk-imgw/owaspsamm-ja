# 概要

本書では、アジャイルがソフトウェア開発中に十分なセキュリティを継続的に構築するために、SAMM セキュリティ慣行がどのように機能するかを説明します。これは、ベストプラクティスと落とし穴の形で構成されています。

## SAMM アジャイルガイダンスの作成理由

ソフトウェア保証成熟度モデル (SAMM)は、安全な開発プロセスをセットアップして成長させる方法に関する OWASP の主力プロジェクトです。アジャイルが明示的にカバーされていないのは、開発アプローチにとらわれないためです。それにもかかわらず、安全なソフトウェア開発をアジャイル環境で機能させる方法に関するガイダンスが業界で強く必要とされているようです。要件の選択、脅威のモデリング、検証など、必要なすべての活動をどのようにスプリントに詰め込みますか? ストーリー、悪用者のストーリー、および「完了の定義」で何をしますか? 品質ゲートを設定するだけでなく、セキュリティチームと開発者が協力するにはどうすればよいでしょうか?

SAMM アジャイルガイダンスには、主に次の 3 つの理由があります。

1. 本ガイダンスでは、アジャイルの活動がどう（わずかに）異なるかについての詳細を提供します。
1. さらに、アジャイルで活動を実装する方法 (例えば、コードレビューを積み上げ方式にする方法) と、注意すべき落とし穴について詳しく説明します。特にアジャイルな状況では、ソフトウェアセキュリティを実行する際に、実際に多くの間違いを犯します。
1. 本ガイダンスにより、SAMM が「過度のウォーターフォール」と見なされるのを防ぎます。

## 歴史

2018 年 4 月以来、Rob van der Veer は、SAMM ワーキング グループや業界の同業者、クライアントと協力して、このガイダンスに従って SAMM の拡張に取り組んできました。これらの同業者には、特に Michael Kuipers (Centric) と Eric Nieuwland (ICTU) が含まれます。アジャイルガイダンスは、何が機能し何が機能しないかについて多くの組織を調査し、インタビューを行い、このトピックに関する多くの出版物を調べることによって作成されました。

## 本書の内容

- 全般
  - 迅速な品質
  - 成熟度モデルはアジャイルと矛盾しますか?
- 教育とガイダンス
  - チームの自律性
  - セキュリティは共同責任です
- 戦略と指標
  - 指標
- 脅威評価
  - 増分脅威モデリング
- セキュリティ要件
  - 要件の選択と準備
  - ストーリーの要件
- セキュリティテスト
  - アジャイルテスト
- 要件駆動型テスト
  - 悪用者のストーリー



この図では、SAMM モデルに関連する本書の項目を示しています。

# 全般

## 目標: 迅速な品質

品質を迅速に達成するには？アジャイルではソフトウェアをより頻繁に提供します。これは、品質保証がより頻繁に問題になることを意味します。従来、品質保証は、ソフトウェア開発において慎重に設計された単一フェーズでした。課題は、官僚的な作業を減らし、時間を短縮し、高品質のソフトウェアを入手することです。これを実現するためには、手作業と開発者の負担を最小限に抑えるために、最大限の効率で間違いを防止し（セキュリティを組み込む）、対処する（間違いを見つける）ことの両方が必要となります。

### 防止

- 可能な限り多くのセキュリティを確保する堅固なテクノロジー/フレームワーク/コンポーネントを使用します。
- 常に対処する必要がある要件の数を減らすために、残要件は明確であり、可能な限り状況に応じて適用されます。
- 製品オーナーを含む関係者全員の責任とセキュリティ原則の理解。
- 開発者向けの実行可能で状況に応じた指示。本を山積みするのではなく、目前の特定のタスクに基づいて要件を選択する明確な短いリスト。
- エラーを最小限に抑えるためのコードの優れた変更可能性（保守性）

### 対処

- 可能な限り自動化する必要があるチェックによって実施されます。
- 手動によるチェックは引き続き必要であり、変更とその影響のみに焦点を当てて、リスクに基づいた段階的なスマートな方法で実行する必要があります。

SAMM Agile ガイダンスは、これを実現する方法についての洞察を提供します。

### 成熟度モデルはアジャイルと矛盾しますか?

成熟度モデルは、アジャイルのマニフェストと矛盾するように見えるかもしれません。なぜなら、アジャイルはプロセスよりも人を、文書よりも作業中のソフトウェアを重視するからです。しかし、アジャイルはプロセスや文書化を不適格とするわけではなく、可能な限り最小限に抑えたいと考えています。これを実現するために、成熟度モデルは、大きな助けとなり、作業を進めながら学習することで作業方法を改善するアジャイルな方法をサポートします。


教育とガイダンス
チームの自律性
ほとんどのアジャイル環境では、チームの自律性が重要です。つまり、組織全体の規模でプロセスの成熟度に取り組むのは難しい場合があります。チームの自律性が重要である場合、成熟度プログラムは、異なるチームが異なる成熟度と、セキュリティを含む異なる作業方法を持つことができることを受け入れる必要があります。同時に、チームが互いに学べるようにすることをお勧めします。そのため、チーム間でプラクティスを共有することは、成熟度プログラムのベスト プラクティスであり、ゲーミフィケーションを育む成熟度の透明性でもあります。

チームの議題にセキュリティを含めるには、改善とふりかえりの両方で標準的なトピックにする必要があります。時間が経つにつれて、チームは、どのセキュリティ上の懸念が多くの労力を費やしたか、または過小評価されているかを学びます。その経験により、計画はより正確で予測可能になります。セキュリティ スペシャリスト (セキュリティ チャンピオンになる可能性がある) は、これらのセッション中に詳細と知識のギャップを埋めるために非常に役立ちます。

セキュリティは共同責任です
アジャイル環境では、最初からセキュリティを組み込む必要があります。セキュリティについてあまり心配せずに機能を構築し、セキュリティ テストを行ってから弱点を修正するというアプローチのすべてのスプリントの時間はありません。まず第一に、これには毎回無責任な完全なテストが必要であり、多くの再作業が必要になるため、製品所有者と開発チームがセキュリティ チームと争っている状況につながります。したがって、セキュリティは製品所有者を含む全員が所有する必要があります。これにより、セキュリティの専門家は、チームとは異なる利害関係を持つ品質ゲートの役割よりも、助言とサポートの役割にはるかに置かれます。議論と計画にセキュリティを含めることで、セキュリティを無視する余地はありません。

安全なソフトウェア開発を成熟させる一方で、ある時点でセキュリティの専門知識への依存がボトルネックになる可能性があります。そのため、チームの自律性を確保し、セキュリティの専門家から学ぶチーム メンバーを促進することが重要です。このようにして、プロセスの合理化と自動化とともに、セキュリティはスケーラブルになります。

PITFALL #isolatedsecurity
一部の組織では、残念ながら、「セキュリティ部門」がソフトウェアを検証し、見つかった問題を修正するよう「ビジネス」を説得する必要があるように、セキュリティが組織化されています。これは通常、ビジネス価値が機能の数で測定され、セキュリティが損害を防止してビジネス価値を保護するために必要な品質ではなく、コスト センターと見なされる場合に当てはまります。製品のデモが定期的に行われている場合は、「ビジネス機能」の横に、セキュリティのために何が行われたかを示すと役立ちます。そうすれば、利害関係者と開発者はその重要性を体験できます。

セキュリティ チャンピオン
セキュリティ チャンピオンは、チーム内の開発者と情報セキュリティの間の連絡役です。彼らはセキュリティ関連の質問の連絡先として機能し、チームがソフトウェアを安全に開発することを妨げている障害を取り除こうとします。アジャイルでの継続的なコラボレーションのため、この役割は非常に重要です。

PITFALL #relyonthechampion
セキュリティが責任として 1 人の開発者に委任されないように注意する必要があります。チャンピオンは可能な限り支援する責任がありますが、それによってチームのセキュリティ上の懸念が解消されるわけではありません。

PITFALL #silentchampion
適切なチャンピオンの選択に関して: 技術的な知識よりも、コミュニケーションと学習を行うチャンピオンの能力と使命が重要な側面となるはずです。

SAMM モデルの組織と文化を参照してください。


戦略と指標
指標
アジャイルでは、フィードバック ループが短く、検証が頻繁に行われます。測定しないものを制御することはできません。そのため、セキュリティを議題に入れ、結果の成熟度と品質を向上させるために、それらの側面を測定することは有益です。理想的には、これらの測定値が 1 つまたは一連のダッシュボードに表示され、中央のセキュリティ チームが経営陣と共に使用して重要な意思決定を行うことができます。

SAMM モデルのメトリックを参照してください。


脅威評価
増分脅威モデリング
アジャイル マニフェストには「包括的なドキュメントよりも機能するソフトウェアの方が重要である」と記載されていますが、脅威モデルの概念を無視するべきではありません。まず第一に、脅威モデルは、開発チームで起こりうる攻撃の共有メンタル モデルを提供し、セキュリティ ミスの可能性を減らします。第 2 に、脅威モデルは、適切な要件を選択するのに役立ちます。つまり、システム全体およびストーリー固有のものです (「ストーリー内の要件」および「要件の選択と準備」を参照してください)。

脅威モデリング プロセス全体を毎回やり直す必要はありません。新しいコンポーネント、プロセス、データフロー、または信頼境界を導入するかどうかを新しいストーリーごとに評価することで、ソフトウェアの進化に合わせて段階的に実行できます。そうであれば、既存の脅威モデルを拡張し、新しい脅威とその対策を (機能的なセキュリティ ストーリーまたは新しいストーリーの要件の形で) 識別することが役立つ場合があります。脅威モデルがチームがセキュリティを構築するための重要な方法である場合、システムの脅威モデルを時々完全に作り直す必要があります。

段階的に適用する場合、主要な質問に基づいて、4 つのステップの軽量バージョンを使用できます。つまり、何を行っているか、何が問題になる可能性があるか、脅威から防御するために何を行っているか、および前のステップの検証です。

ドメイン コンテキスト、対策の経済的感覚に関する迅速な現実チェックを取得し、セキュリティ所有者の統合された感覚を育むために、製品所有者を関与させることをお勧めします。

ピットフォール #onlythreatmodel
脅威モデリングは、セキュリティを組み込むための唯一の方法として頼るべきではありません。通常、開発者や QA 担当者が攻撃者のように考えて、うまくいかない可能性のあるすべてのものと必要なすべての対策を考え出すことは困難です。これが、特定の種類の作業が完了したときにセキュリティ要件をすぐに選択できるようにしておくことが非常に重要である理由です (「要件の選択と準備」を参照)。セキュリティを強化するこのアプローチ (場合によっては、セキュリティ衛生) は、セキュリティを組み込む方法を確認するための別の視点として、脅威モデリングのリスクベースのアプローチをうまく補完します。セキュリティ要件を適用する他の方法をどれだけ信頼するかにかかっています。

SAMM モデルでの脅威モデリングを参照してください。


セキュリティ要件
要件の選択と準備
アジャイル プロセスでは、スプリントごとにいくつかの要件を選択してテストする必要があります。これを実現するためには、システムごと、ストーリーごとに関連する要件を選択して準備するプロセスが必要です。目標は、ストーリー プロセスを効率化し、開発者への指示やテスト計画など、各状況に関連する要件を最小限に抑えることです。

システムごと
開発を開始する前に、一連の標準要件から要件を選択できます。標準要件は通常、業界標準とコンプライアンスを考慮して組織レベルで確立されます。この選択プロセスは、ソフトウェアのコンテキスト (ドメイン、役割、リスク テクノロジの選択、ランタイム環境) に基づいており、このコンテキストが変化したときに再検討する必要があります。リスク分析は、このプロセスの典型的な部分です。非機能要件ごとに、選択と準備には次のオプションがあります。

文脈に当てはまらない
該当するがリスクを受け入れる
使用されているテクノロジーによってカバーされている (入力検証などを提供するフレームワーク/ライブラリなど)
システム全般またはストーリー固有の指示 X およびテスト A、B、C (自動静的スキャン、自動動的テスト、手動テスト、コード レビュー、または組み合わせなど) が必要です。ストーリー固有の要件については、該当する場合、基準を記述する必要があります。いわゆるトリガーです。
この選択と準備の後、システムの一般的な要件は完了の定義から参照されますが、ストーリー固有の要件は、トリガーによってグループ化されたピック リストで使用可能になり、作業の種類に応じて適切な要件を後で選択することができます。物語の中で行われています。選択されたストーリー固有の要件は、開発者への指示と実行されるテストの形で、ストーリーの受け入れ基準の一部になります。準備および選択された要件は、トレーニング プログラムへのインプットとしても機能します。

要約すると、システムごとの選択と準備の成果物は次のとおりです。

トリガーに基づいて、ストーリーごとに状況に応じて適用する必要がある要件の選択リスト
常に適用する必要がある要件のリストを含む、完了の定義
開発者トレーニングに含める必要がある上記の要件の選択
適用できない、またはリスクを許容できないと見なされた要件のリスト (セキュリティと労力のバランス、またはユーザビリティ/パフォーマンスなどの妥協に基づく場合があります)
各要件には、短い名前または番号、リスクの説明、開発者への指示、自動テスト、テスター/レビュー担当者への指示があります。

1話あたり
ストーリーの特定の要件の選択は、必要に応じてセキュリティの専門家の助けを借りて、ストーリーの作成中およびバックログの調整中に行われます。要件を選択するには、さまざまな方法があります。

ピック リストからのトリガーの使用: 要件が「トリガー」で準備されている場合、これらを使用して、要件がストーリーに適合するかどうかを判断できます。
専門知識の使用: セキュリティの専門知識は、ストーリーの適切な要件を効率的に選択するのに役立ちます。
悪用事例 (システムがどのように攻撃されるか) を使用する: 弱点を特定し、適切な要件にリンクするのに役立ちます。
上記の方法で十分な信頼性が得られない場合: 脅威モデリングを使用します。
つまり、トリガーは、特定の要件セットを必要とする機能またはアーキテクチャの記述です。例: 「ユーザー フォーム」 (ユーザー入力の検証に関する要件)、「セッション」 (トークン、タイムアウトなどに関する要件)、または「パスワードの保存」 (ハッシュに関する要件)。

要件は、ストーリーの受け入れ基準に入れられます。これにより、作業を計画および実行するために何を考慮する必要があるかが開発者に通知され、必要なテストが追加されます。

指示

要件には、ソフトウェアが準拠する必要があるルールが含まれています。これらのルールは、開発者向けの指示としては理想的ではありません。既知であることが期待される基準が省略され、他の基準が開発者の観点から表現されている個別の指示があると役立ちます。目標は、開発者が考慮に入れるための小さくて扱いやすい一連の指示を用意することです。その結果、一部の要件には、テストはあるものの、指示がまったくない場合さえあります。これは、組織が特定の問題に関する開発者の知識に依存している場合です。

ソフトウェア開発プロセスの概要と要件の流れについては、以下の図を参照してください。

SAMM アジャイル要件プロセス
ピットフォール #requirementoverload
要件が多すぎると、開発者が常に意識しなければならないことが多すぎて、毎回テストするのに多大な労力がかかる可能性があります。したがって、目標は、使用するテクノロジ/アーキテクチャによってできるだけ多くの要件をカバーし、ストーリー内の作業の種類に応じてできるだけ多くの要件を持たせることです。

PITFALL #forgettheframework
フレームワークとライブラリはセキュリティ要件の一部をカバーできるため、これらのフレームワークとライブラリが使用されていることを確認することを忘れてはなりません。多くの場合、開発者は、故意であろうと怠慢であろうと、既存の施設を簡単に回避できます。言い換えれば、フレームワークとライブラリの適切な適用は、技術的に強制されるか、特定または一般的なテスト手順の一部である必要があります。

PITFALL #abuseCOS
チームが「満足の条件」で作業する場合、これらは通常、機能上の動作に関するものであるため、セキュリティ要件に使用しないでください。さらに、ストーリー固有の要件も、定義の完了には含めるべきではありません。これらはユーザー ストーリーに依存しないためです。

ピットフォール #onlythreatmodeling セキュリティ
を組み込む唯一の方法として、脅威モデリングに頼るべきではありません。通常、開発者やテスターが攻撃者のように考えて、うまくいかない可能性のあるすべてのものと必要なすべての対策を考え出すことは困難です。これが、特定の種類の作業が完了したときに、セキュリティ要件をすぐに選択できるようにすることが非常に重要である理由です。セキュリティを強化するこのアプローチ (場合によっては、セキュリティ衛生) は、セキュリティを組み込む方法を確認するための別の視点として、脅威モデリングのリスクベースのアプローチをうまく補完します。セキュリティ要件を適用する他の方法をどれだけ信頼するかにかかっています。

ストーリーの要件
「要件の選択と準備」も参照してください。ストーリーには、予想される作業のタイプに基づいて、ストーリーの受け入れ基準に入れるために、関連する非機能要件を備える必要があります。これは開発者に何を考慮すべきかを知らせ、必要なテストに追加し、作業を計画するために必要な情報を提供します。ストーリーの装備は、ストーリーの作成中とバックログの改良中に行われます。開発者がこれに苦労している場合は、必要に応じてセキュリティの専門家の助けを借りてください。要件を収集するには、さまざまな方法があります。

トリガーの使用: 選択リストの要件が「トリガー」で準備されている場合、これらを使用して、要件がストーリーに適合するかどうかを識別できます (たとえば、パスワードを保存する場合: 特定のハッシュを適用します)。
専門知識の使用: セキュリティの専門知識は、ストーリーを使用して適切な要件を効率的に選択するのに役立ちます
悪用事例 (システムがどのように攻撃されるか) を使用する: 弱点を特定し、適切な要件にリンクするのに役立ちます。
脅威モデリング演習の使用 (「増分脅威モデリング」を参照)
PITFALL #skipsecurityrequirements
アジャイル セキュリティの鍵は、適切な要件を適切なタイミングで適用することです。ストーリーでセキュリティ要件が言及されていない場合は、忘れがちです。これは、そのための時間が計画されていないためでもあります。

PITFALL #pickduringplanning
ピッキング要件は、ストーリーの作成中またはバックログの改良中に行う必要があります。スプリント計画中にこれを行うことはお勧めしません。計画には常に時間が必要になるからです。

SAMM モデルのソフトウェア要件を参照してください。


要件駆動型テスト
虐待の話
悪用ストーリー (または邪悪なストーリー) は、攻撃者 (ユーザーに想定される) の観点からの説明であり、セキュリティの弱点によってシステムがどのように悪用されるかを説明します: 「攻撃者として…」. 計画可能な特定の開発作業を記述していないため、通常、スプリント バックログには追加されません。虐待ストーリーの目的は、チームがユーザー ストーリーで必要な作業/要件を指定できるように、何がうまくいかないかをチームが考えるのを助けることです。開発者はユーザー ストーリーに精通しているため、悪用ストーリーの形式は役に立ちます。悪用ストーリーは、主に開発初期に有利です。悪用の話は、特定のセキュリティ テストの説明として役立ちます。たとえば、特定の要件をテストする必要がある脅威に対するペンテスターを説明します。

ピットフォール #abusestorygalore
セキュリティ要件を見つける方法は、虐待のストーリーだけであってはなりません (「ストーリーの要件」を参照)。トリガーや専門知識を適用したり、トリガーを使用したりすることで、要件を追加することもできます。これにより、何がうまくいかないかを最初に考える必要がなくなり、より直接的かつ効率的な選択が可能になります。

SAMM モデルにおける誤用/乱用テストを参照してください。


セキュリティテスト
アジャイルテスト
アジャイルでは、テストはより頻繁に行われ、通常はシステムの同じ部分を何度もカバーします。そのため、テストを可能な限り自動化し、変更に基づいて手動テストを制限することが重要です。

セキュリティ テストの自動化は、ユニットおよび統合レベルでテストをプログラミングし、テスト ツールを展開することで実行できます。重要なテスト ツールのカテゴリは、依存関係チェック ツール (SCA)、動的アプリケーション セキュリティ テスト ツール (DAST)、静的分析ツール (SAST) です。通常、SAST および依存関係ツールの出力には、手動でチェックする必要がある多くの誤検知が含まれています。

すべてのテストを自動化できるわけではありません。たとえば、SAST ツールは、コード内の問題の特定のカテゴリに限定されます。予想される変更の影響に基づいて、必要な時間のかかる手動テストを最小限に抑えることができます。コードレビューの場合、これはレビューが変更および追加されたコードのみに焦点を当てる必要があることを意味し、したがって構造化されたアプローチと管理が必要です。手動ペンテストの場合、これは、変更によって影響を受ける可能性が高い動作に焦点を当ててテストする必要があることを意味します。変更による行動への影響を予測するのは難しいため、侵入テストを制限する際にミスが発生する可能性があります。そのため、そのようなミスのリスクが高いと見なされる場合は、完全な侵入テストを実行することをお勧めします。

変更ベースのテスト選択の必要性は、特にアジャイルの場合、モジュールを個別にテストでき、変更の伝播が制限されているモジュラー システムを持つことが重要であることを示しています。アジャイル環境では、通常、スプリントごとに専門家による詳細な手動レビューとテストを行うための予算はありません。これは、リリース計画において、そのような手作業がいつ必要になると予想されるかを考慮に入れる必要があることを意味し、準備と計画を行うことができます。

アジャイルのベスト プラクティスは、開発チームに QA の能力を持たせることです。これには、セキュリティ テストの能力を含める必要があります。

PITFALL #skipmanualtest
自動化だけでは、通常、うまくいきません。専門家によるコード レビューと手動ペンテストの両方が、ソフトウェアの品質保証の一部である必要があります。

落とし穴#latepentest
従来のペネトレーション テストの落とし穴は、一般公開の直前に遅く実行することです。つまり、やり直しに最も費用がかかり、時間が最も短いときです。

SAMM モデルでのセキュリティ テストを参照してください。

著者
Rob van der Veer (Software Improvement Group) は、多くの同僚やクライアントの助けを借りて.

メディア
GlobalAppsec Amsterdam 2019 での講演 
スライド 